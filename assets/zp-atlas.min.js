const zpForm=document.getElementById("zp-birthreport-form");var a,b,cityIn=document.getElementById("placein"),zpSubmit=document.getElementById("zp-fetch-birthreport");zpSubmit.setAttribute("disabled",!0),a=this,b=function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e){return"string"==typeof e?document.querySelector(e):e()}function n(e){return e.innerHTML=""}function o(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}var r="data-result",s="autoComplete_result",i=t,l=function(e){var t=document.createElement(e.element);return t.setAttribute("id","autoComplete_results_list"),e.container&&e.container(t),e.destination.insertAdjacentElement(e.position,t),t},a=function(e){return"<span class=".concat("autoComplete_highlighted",">").concat(e,"</span>")},u=function(e,t,n){t.forEach(function(o,i){var l=document.createElement(n.element),a=t[i].value[o.key]||t[i].value;l.setAttribute(r,a),l.setAttribute("class",s),l.setAttribute("tabindex","1"),n.content?n.content(o,l):l.innerHTML=o.match||o,e.appendChild(l)})},c=n,d=function(e,o,i,l){var a=o.querySelectorAll(".".concat(s));Object.keys(a).forEach(function(u){["mousedown","keydown"].forEach(function(c){a[u].addEventListener(c,function(a){"mousedown"!==c&&13!==a.keyCode&&39!==a.keyCode||(i({event:a,query:t(e)instanceof HTMLInputElement?t(e).value:t(e).innerHTML,matches:l.matches,results:l.list.map(function(e){return e.value}),selection:l.list.find(function(e){return(e.value[e.key]||e.value)===a.target.closest(".".concat(s)).getAttribute(r)})}),n(o))})})})};o.prototype=window.Event.prototype;var p={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||o,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}};return function(){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.selector=e.selector||"#autoComplete",this.data={src:function(){return"function"==typeof e.data.src?e.data.src():e.data.src},key:e.data.key,cache:void 0===e.data.cache||e.data.cache},this.query=e.query,this.searchEngine="loose"===e.searchEngine?"loose":"strict",this.threshold=e.threshold||0,this.debounce=e.debounce||0,this.resultsList={render:!(!e.resultsList||!e.resultsList.render)&&e.resultsList.render,view:e.resultsList&&e.resultsList.render?l({container:!(!e.resultsList||!e.resultsList.container)&&e.resultsList.container,destination:e.resultsList&&e.resultsList.destination?e.resultsList.destination:i(this.selector),position:e.resultsList&&e.resultsList.position?e.resultsList.position:"afterend",element:e.resultsList&&e.resultsList.element?e.resultsList.element:"ul"}):null},this.sort=e.sort||!1,this.placeHolder=e.placeHolder,this.maxResults=e.maxResults||5,this.resultItem={content:!(!e.resultItem||!e.resultItem.content)&&e.resultItem.content,element:e.resultItem&&e.resultItem.element?e.resultItem.element:"li"},this.noResults=e.noResults,this.highlight=e.highlight||!1,this.onSelection=e.onSelection,this.dataSrc,this.init()}return function(t,n,o){n&&e(t.prototype,n)}(n,[{key:"search",value:function(e,t){var n=this.highlight,o=t.toLowerCase();if("loose"===this.searchEngine){e=e.replace(/ /g,"");for(var r=[],s=0,i=0;i<o.length;i++){var l=t[i];s<e.length&&o[i]===e[s]&&(l=n?a(l):l,s++),r.push(l)}return s===e.length&&r.join("")}if(o.includes(e))return e=new RegExp("".concat(e),"i").exec(t),n?t.replace(e,a(e)):t}},{key:"listMatchedResults",value:function(e){var n=this;return new Promise(function(o){var r=[];e.filter(function(e,t){function o(o){var s=n.search(n.queryValue,e[o]||e);s&&o?r.push({key:o,index:t,match:s,value:e}):s&&!o&&r.push({index:t,match:s,value:e})}if(n.data.key){var s=!0,i=!1,l=void 0;try{for(var a,u=n.data.key[Symbol.iterator]();!(s=(a=u.next()).done);s=!0)o(a.value)}catch(o){i=!0,l=o}finally{try{s||null==u.return||u.return()}finally{if(i)throw l}}}else o()});var s=n.sort?r.sort(n.sort).slice(0,n.maxResults):r.slice(0,n.maxResults);return n.resultsList.render&&(u(n.resultsList.view,s,n.resultItem),function(e,n){var o=t(e),r=n.firstChild;document.onkeydown=function(t){if(t.target.matches(e)){var s=document.activeElement;switch(t.keyCode){case 38:s!==r&&s!==o?s.previousSibling.focus():s===r&&o.focus();break;case 40:s===o&&0<n.childNodes.length?r.focus():s!==n.lastChild&&s.nextSibling.focus()}}}}(n.selector,n.resultsList.view)),o({matches:r.length,list:s})})}},{key:"ignite",value:function(){var e,t,n,o=this,r=this.selector,s=i(r),l=this.query,a=this.placeHolder;function u(e){function t(e,t){s.dispatchEvent(new p.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:e,input:n,query:i,matches:t?t.matches:null,results:t?t.list:null},cancelable:!0}))}var n=s instanceof HTMLInputElement?s.value.toLowerCase():s.innerHTML.toLowerCase(),i=o.queryValue=l&&l.manipulate?l.manipulate(n):n,a=o.resultsList.render,u=i.length>o.threshold&&i.replace(/ /g,"").length;if(a){var m=o.onSelection,f=o.resultsList.view;c(f),u?o.listMatchedResults(o.dataSrc).then(function(n){t(e,n),0===n.list.length&&o.noResults&&o.resultsList.render?o.noResults():m&&d(r,f,m,n)}):t(e)}else!a&&u?o.listMatchedResults(o.dataSrc).then(function(n){t(e,n)}):t(e)}a&&s.setAttribute("placeholder",a),s.addEventListener("keyup",(e=function(e){if(o.data.cache)u(e);else{var t=o.data.src();t instanceof Promise?t.then(function(t){o.dataSrc=t,u(e)}):(o.dataSrc=t,u(e))}},t=this.debounce,function(){var o=this,r=arguments;clearTimeout(n),n=setTimeout(function(){return e.apply(o,r)},t)}))}},{key:"init",value:function(){var e=this,t=this.data.src();t instanceof Promise?t.then(function(t){e.dataSrc=t,e.ignite()}):(this.dataSrc=t,this.ignite()),p.initElementClosestPolyfill()}}]),n}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();const autoCompletejs=new autoComplete({data:{src:async function(){if(!(cityIn.value.length<2)){const n=cityIn.value,o=zpastr.ajaxurl,r=await fetch(`${o}?action=zp_atlas_get_cities&c=${n}`),s=await r.json();var e=[];if(zpRemoveError(),void 0!==s.status)zpShowError("ERROR "+s.status.value+" - "+s.status.message);else for(var t=0;t<s.length;t++)e[t]={name:s[t].value,lat:s[t].lat,lng:s[t].long,zone:s[t].tz};return e}},key:["name"],cache:!1},selector:"#placein",threshold:1,searchEngine:"loose",maxResults:20,resultsList:{render:!0,container:function(e){e.setAttribute("id","autoComplete_results_list")},destination:cityIn,position:"afterend",element:"ul"},resultItem:{content:function(e,t){t.innerHTML=e.match},element:"li"},onSelection:function(e){cityIn.value="",cityIn.setAttribute("placeholder",e.selection.value.name),document.getElementById("place").value=e.selection.value.name,document.getElementById("geo_timezone_id").value=e.selection.value.zone,document.getElementById("zp_lat_decimal").value=e.selection.value.lat,document.getElementById("zp_long_decimal").value=e.selection.value.lng,zpGetOffset()}});function zpGetOffset(){const e=Array.from(new FormData(zpForm),e=>e.map(encodeURIComponent).join("=")).join("&")+"&action=zp_tz_offset",t=new XMLHttpRequest;t.open("POST",zpastr.ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.responseType="json",t.onload=function(){200===t.status&&t.response&&(t.response.error?(zpRemoveError(),zpShowError(t.response.error)):null!==t.response.offset_geo&&""!==t.response.offset_geo&&"false"!=t.response.offset_geo&&(zpRemoveError(),document.getElementById("zp-offset-wrap").style.display="block",document.getElementById("zp_offset_geo").value=t.response.offset_geo,document.getElementById("zp-form-tip").style.display="block",zpSubmit.removeAttribute("disabled")))},t.send(e)}function redoOffset(e){if("unknown_time"===e.target.id)e.target.checked&&zpFieldsFilled()&&zpGetOffset();else{if(!["month","day","year","hour","minute"].includes(e.target.id))return;!e.target.options[e.target.selectedIndex].defaultSelected&&zpFieldsFilled()&&zpGetOffset()}}function zpFieldsFilled(){for(var e of["geo_timezone_id","zp_long_decimal","zp_lat_decimal","place","minute","hour","year","day","month"]){var t=document.getElementById(e);if(null===t)return!1;if(0===t.value.length||!t.value.trim()){if(("minute"===e||"hour"===e)&&document.getElementById("unknown_time").checked)continue;return!1}}return!0}function zpRemoveError(){var e=document.querySelector(".ui-state-error");null!==e&&e.parentNode.removeChild(e)}function zpShowError(e){var t=document.createElement("span");t.setAttribute("class","ui-state-error"),t.textContent=e,document.getElementById("zp-birthplace").appendChild(t)}zpSubmit.addEventListener("click",function(e){e.preventDefault();const t=Array.from(new FormData(zpForm),e=>e.map(encodeURIComponent).join("=")).join("&"),n=new XMLHttpRequest;n.open("POST",zpastr.ajaxurl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json",n.onload=function(){if(200===n.status&&n.response)if(n.response.error)zpRemoveError(),zpShowError(n.response.error);else{var e=n.response.report.trim();if(e&&"false"!=e){var t=document.getElementById("zp-report-content"),o=document.getElementById("zp-report-wrap");switch(zpRemoveError(),o.style.display="block",t.insertAdjacentHTML("afterbegin",n.response.report),document.getElementById("zp-form-wrap").style.display="none",zpastr.draw){case"top":document.querySelector(".zp-report-header").insertAdjacentHTML("afterend",n.response.image);break;case"bottom":t.insertAdjacentHTML("beforeend",n.response.image)}window.scrollTo({top:o.offsetTop+70,behavior:"smooth"})}}},n.send(t)}),zpForm.addEventListener("change",redoOffset);
